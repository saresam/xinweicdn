(function(n){n.suggest=function(t,i){function s(){var n=u.offset();r.css({top:n.top+t.offsetHeight+"px",left:n.left+"px"})}function v(n){if(/27$|38$|40$/.test(n.keyCode)&&r.is(":visible")||/^13$|^9$/.test(n.keyCode)&&h()){n.preventDefault&&n.preventDefault();n.stopPropagation&&n.stopPropagation();n.cancelBubble=!0;n.returnValue=!1;switch(n.keyCode){case 38:d();break;case 40:k();break;case 9:case 13:a();break;case 27:r.hide()}}else u.val().length!=c&&(e&&clearTimeout(e),e=setTimeout(y,i.delay),c=u.val().length)}function y(){var t=n.trim(u.val()),f,e;i.multiple&&(f=t.lastIndexOf(i.multipleSep),f!=-1&&(t=n.trim(t.substr(f+i.multipleSep.length))));t.length>=i.minchars?(cached=p(t),cached?l(cached.items):n.get(i.source,{q:t},function(n){r.hide();e=b(n,t);l(e);w(t,e,n.length)})):r.hide()}function p(n){for(var t=0;t<f.length;t++)if(f[t].q==n)return f.unshift(f.splice(t,1)[0]),f[0];return!1}function w(n,t,r){for(var u;f.length&&o+r>i.maxCacheSize;)u=f.pop(),o-=u.size;f.push({q:n,size:r,items:t});o+=r}function l(t){var f="",u;if(t){if(!t.length){r.hide();return}for(s(),u=0;u<t.length;u++)f+="<li>"+t[u]+"<\/li>";r.html(f).show();r.children("li").mouseover(function(){r.children("li").removeClass(i.selectClass);n(this).addClass(i.selectClass)}).click(function(n){n.preventDefault();n.stopPropagation();a()})}}function b(t,r){for(var e=[],o=t.split(i.delimiter),u,f=0;f<o.length;f++)u=n.trim(o[f]),u&&(u=u.replace(new RegExp(r,"ig"),function(n){return'<span class="'+i.matchClass+'">'+n+"<\/span>"}),e[e.length]=u);return e}function h(){var n;return r.is(":visible")?(n=r.children("li."+i.selectClass),n.length||(n=!1),n):!1}function a(){$currentResult=h();$currentResult&&(i.multiple?($currentVal=u.val().indexOf(i.multipleSep)!=-1?u.val().substr(0,u.val().lastIndexOf(i.multipleSep)+i.multipleSep.length)+" ":"",u.val($currentVal+$currentResult.text()+i.multipleSep+" "),u.focus()):u.val($currentResult.text()),r.hide(),u.trigger("change"),i.onSelect&&i.onSelect.apply(u[0]))}function k(){$currentResult=h();$currentResult?$currentResult.removeClass(i.selectClass).next().addClass(i.selectClass):r.children("li:first-child").addClass(i.selectClass)}function d(){var n=h();n?n.removeClass(i.selectClass).prev().addClass(i.selectClass):r.children("li:last-child").addClass(i.selectClass)}var u,r,e,c,f,o;u=n(t).attr("autocomplete","off");r=n("<ul/>");e=!1;c=0;f=[];o=0;r.addClass(i.resultsClass).appendTo("body");s();n(window).on("load",s).on("resize",s);u.blur(function(){setTimeout(function(){r.hide()},200)});u.keydown(v)};n.fn.suggest=function(t,i){if(t)return i=i||{},i.multiple=i.multiple||!1,i.multipleSep=i.multipleSep||",",i.source=t,i.delay=i.delay||100,i.resultsClass=i.resultsClass||"ac_results",i.selectClass=i.selectClass||"ac_over",i.matchClass=i.matchClass||"ac_match",i.minchars=i.minchars||2,i.delimiter=i.delimiter||"\n",i.onSelect=i.onSelect||!1,i.maxCacheSize=i.maxCacheSize||65536,this.each(function(){new n.suggest(this,i)}),this}})(jQuery)